<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Physics Demo</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;justify-content:center;align-items:center;color:#fff;overflow:hidden}
.container{width:98%;max-width:1600px;background:rgba(255,255,255,0.08);backdrop-filter:blur(20px);border-radius:25px;padding:25px;box-shadow:0 20px 60px rgba(0,0,0,0.4);border:1px solid rgba(255,255,255,0.1)}
h1{text-align:center;margin-bottom:8px;font-size:2.8em;text-shadow:3px 3px 6px rgba(0,0,0,0.4);background:linear-gradient(135deg,#fff,#a8c0ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.subtitle{text-align:center;margin-bottom:20px;opacity:0.95;font-size:1.15em;text-shadow:1px 1px 2px rgba(0,0,0,0.3)}
.controls{display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;justify-content:center;align-items:center}
button{background:rgba(255,255,255,0.15);border:2px solid rgba(255,255,255,0.25);color:white;padding:10px 22px;border-radius:12px;cursor:pointer;font-size:15px;font-weight:600;transition:all 0.25s ease;backdrop-filter:blur(10px);box-shadow:0 4px 15px rgba(0,0,0,0.2)}
button:hover{background:rgba(255,255,255,0.28);transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,0.3)}
button:active{transform:translateY(0);box-shadow:0 2px 10px rgba(0,0,0,0.3)}
button.active{background:linear-gradient(135deg,rgba(255,255,255,0.35),rgba(255,255,255,0.25));border-color:rgba(255,255,255,0.5);box-shadow:0 0 20px rgba(255,255,255,0.3)}
.canvas-container{position:relative;background:rgba(10,14,26,0.6);border-radius:18px;overflow:hidden;box-shadow:inset 0 4px 20px rgba(0,0,0,0.5),0 10px 40px rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.05)}
canvas{display:block;width:100%;height:auto;cursor:crosshair}
.info{text-align:center;margin-top:15px;opacity:0.85;font-size:13px;line-height:1.6}
.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-top:10px}
.info-item{background:rgba(255,255,255,0.1);padding:8px 12px;border-radius:8px;font-size:12px;backdrop-filter:blur(5px)}
.loading{text-align:center;padding:60px;font-size:1.6em;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:0.6}50%{opacity:1}}
.error{text-align:center;padding:40px;background:rgba(255,50,50,0.25);border-radius:15px;margin:20px 0;border:2px solid rgba(255,100,100,0.4)}
.badge{display:inline-block;background:rgba(255,255,255,0.2);padding:4px 12px;border-radius:12px;font-size:11px;margin:0 4px;font-weight:600}
.separator{width:2px;height:30px;background:rgba(255,255,255,0.2);margin:0 8px}
</style>
</head>
<body>
<div class="container">
<h1>‚ö° Ultimate Physics Engine</h1>
<p class="subtitle">Production-Grade 2D/3D Physics Simulation with Advanced Rendering</p>

<div id="loading" class="loading">üîÑ Loading UnifiedPhysicsEngine.js...</div>

<div id="error" class="error" style="display:none"></div>

<div id="main" style="display:none">
<div class="controls">
<button id="btn2D" class="active">üéÆ 2D Mode</button>
<button id="btn3D">üé≤ 3D Mode</button>
<div class="separator"></div>
<button id="btnCircle">‚ö™ Add Circle</button>
<button id="btnBox">‚¨ú Add Box</button>
<button id="btnPyramid">üî∫ Pyramid</button>
<button id="btnWall">üß± Wall</button>
<div class="separator"></div>
<button id="btnReset">üîÑ Reset</button>
<button id="btnPause">‚è∏Ô∏è Pause</button>
<button id="btnDebug">üêõ Debug</button>
</div>

<div class="canvas-container">
<canvas id="canvas" width="1400" height="800"></canvas>
</div>

<div class="info">
<div style="margin-bottom:8px">
<span class="badge">üñ±Ô∏è Click & Drag to throw objects</span>
<span class="badge">üéØ Click to spawn</span>
<span class="badge">‚¨ÜÔ∏è‚¨áÔ∏è‚¨ÖÔ∏è‚û°Ô∏è Move camera</span>
<span class="badge">üñ±Ô∏è Scroll to zoom</span>
<span class="badge">SPACE Add ball</span>
</div>
<div class="info-grid">
<div class="info-item">üí° Press D for debug view</div>
<div class="info-item">üîÑ Press R to reset scene</div>
<div class="info-item">‚ö° High-precision impulse solver</div>
<div class="info-item">üé® Real-time lighting & shadows</div>
</div>
</div>
</div>
</div>

<script src="UnifiedPhysicsEngine.js"></script>
<script>
window.addEventListener('load',()=>{
const loading=document.getElementById('loading');
const error=document.getElementById('error');
const main=document.getElementById('main');

if(typeof UnifiedPhysics==='undefined'){
loading.style.display='none';
error.style.display='block';
error.innerHTML='<h3>‚ö†Ô∏è UnifiedPhysicsEngine.js not found</h3><p>Please place UnifiedPhysicsEngine.js in the same directory.</p>';
return;
}

loading.style.display='none';
main.style.display='block';
initDemo();
});

function initDemo(){
const{V2,V3,Circle,Box,Sphere,Cube,Body,PhysicsWorld,Renderer,Input,Material}=UnifiedPhysics;

const canvas=document.getElementById('canvas');
let mode='2D';
let world=new PhysicsWorld('2D',{iterations:8,cellSize:120});
let renderer=new Renderer(canvas,world);
let input=new Input(canvas,world,renderer);
let isPaused=false;
let lastTime=performance.now();

const btn2D=document.getElementById('btn2D');
const btn3D=document.getElementById('btn3D');
const btnCircle=document.getElementById('btnCircle');
const btnBox=document.getElementById('btnBox');
const btnPyramid=document.getElementById('btnPyramid');
const btnWall=document.getElementById('btnWall');
const btnReset=document.getElementById('btnReset');
const btnPause=document.getElementById('btnPause');
const btnDebug=document.getElementById('btnDebug');

function init2D(){
mode='2D';
world=new PhysicsWorld('2D',{
gravity:new V2(0,800),
iterations:10,
damping:0.999
});
renderer=new Renderer(canvas,world);
input=new Input(canvas,world,renderer);
renderer.camera.pos=new V2(0,0);
renderer.camera.zoom=1;

// Ground
world.addBody(new Body({
dim:'2D',
shape:new Box(1400,60),
pos:new V2(700,770),
material:new Material({color:'#2c3e50',restitution:0.3}),
static:true
}));

// Walls
world.addBody(new Body({
dim:'2D',
shape:new Box(60,800),
pos:new V2(30,400),
material:new Material({color:'#34495e',restitution:0.3}),
static:true
}));

world.addBody(new Body({
dim:'2D',
shape:new Box(60,800),
pos:new V2(1370,400),
material:new Material({color:'#34495e',restitution:0.3}),
static:true
}));

// Platforms
world.addBody(new Body({
dim:'2D',
shape:new Box(300,30),
pos:new V2(300,550),
material:new Material({color:'#7f8c8d',restitution:0.4}),
static:true
}));

world.addBody(new Body({
dim:'2D',
shape:new Box(300,30),
pos:new V2(1100,550),
material:new Material({color:'#7f8c8d',restitution:0.4}),
static:true
}));

// Seesaw
const seesaw=world.addBody(new Body({
dim:'2D',
shape:new Box(400,20),
pos:new V2(700,450),
angle:0,
material:new Material({color:'#e74c3c',restitution:0.5}),
mass:50
}));

// Pivot
world.addBody(new Body({
dim:'2D',
shape:new Box(40,60),
pos:new V2(700,470),
material:new Material({color:'#c0392b',restitution:0.1}),
static:true
}));

// Dynamic objects
const colors=['#ff6b6b','#4ecdc4','#45b7d1','#f9ca24','#6c5ce7','#fd79a8'];
for(let i=0;i<8;i++){
world.addBody(new Body({
dim:'2D',
shape:new Circle(12+Math.random()*18),
pos:new V2(200+i*150,100+Math.random()*100),
material:new Material({
color:colors[Math.floor(Math.random()*colors.length)],
restitution:0.6+Math.random()*0.3,
staticFriction:0.5,
dynamicFriction:0.3
})
}));
}

for(let i=0;i<6;i++){
world.addBody(new Body({
dim:'2D',
shape:new Box(25+Math.random()*25,25+Math.random()*25),
pos:new V2(300+i*120,200+Math.random()*100),
angle:Math.random()*Math.PI,
material:new Material({
color:colors[Math.floor(Math.random()*colors.length)],
restitution:0.4+Math.random()*0.3,
staticFriction:0.6,
dynamicFriction:0.4
})
}));
}
}

function init3D(){
mode='3D';
world=new PhysicsWorld('3D',{
gravity:new V3(0,-800,0),
iterations:10,
damping:0.998
});
renderer=new Renderer(canvas,world);
input=new Input(canvas,world,renderer);
renderer.camera.pos=new V3(0,0,400);
renderer.camera.zoom=1;

// Ground
world.addBody(new Body({
dim:'3D',
shape:new Cube(1400,40,600),
pos:new V3(700,790,0),
material:new Material({color:'#2c3e50',restitution:0.3}),
static:true
}));

// Walls
world.addBody(new Body({
dim:'3D',
shape:new Cube(60,800,600),
pos:new V3(30,400,0),
material:new Material({color:'#34495e',restitution:0.3}),
static:true
}));

world.addBody(new Body({
dim:'3D',
shape:new Cube(60,800,600),
pos:new V3(1370,400,0),
material:new Material({color:'#34495e',restitution:0.3}),
static:true
}));

// Platforms at different depths
world.addBody(new Body({
dim:'3D',
shape:new Cube(250,30,100),
pos:new V3(300,500,100),
material:new Material({color:'#7f8c8d',restitution:0.4}),
static:true
}));

world.addBody(new Body({
dim:'3D',
shape:new Cube(250,30,100),
pos:new V3(700,400,0),
material:new Material({color:'#95a5a6',restitution:0.4}),
static:true
}));

world.addBody(new Body({
dim:'3D',
shape:new Cube(250,30,100),
pos:new V3(1100,500,-100),
material:new Material({color:'#7f8c8d',restitution:0.4}),
static:true
}));

// Dynamic objects with depth variation
const colors=['#ff6b6b','#4ecdc4','#45b7d1','#f9ca24','#6c5ce7','#fd79a8'];
for(let i=0;i<12;i++){
const z=(i%3-1)*150;
world.addBody(new Body({
dim:'3D',
shape:new Sphere(12+Math.random()*18),
pos:new V3(200+i*80,100+Math.random()*150,z),
material:new Material({
color:colors[Math.floor(Math.random()*colors.length)],
restitution:0.6+Math.random()*0.3,
staticFriction:0.5,
dynamicFriction:0.3
})
}));
}

for(let i=0;i<8;i++){
const z=(i%3-1)*120;
world.addBody(new Body({
dim:'3D',
shape:new Cube(20+Math.random()*30,20+Math.random()*30,20+Math.random()*30),
pos:new V3(300+i*120,250+Math.random()*100,z),
material:new Material({
color:colors[Math.floor(Math.random()*colors.length)],
restitution:0.4+Math.random()*0.3,
staticFriction:0.6,
dynamicFriction:0.4
})
}));
}
}

function createPyramid(){
const colors=['#ff6b6b','#4ecdc4','#45b7d1','#f9ca24','#6c5ce7','#fd79a8'];
const levels=6;
const baseY=mode==='2D'?650:650;
const size=35;

for(let level=0;level<levels;level++){
const count=levels-level;
const y=baseY-level*size*1.1;
const startX=700-(count-1)*size*0.55;

for(let i=0;i<count;i++){
const x=startX+i*size*1.1;
if(mode==='2D'){
world.addBody(new Body({
dim:'2D',
shape:new Box(size,size),
pos:new V2(x,y),
material:new Material({
color:colors[level%colors.length],
restitution:0.3,
staticFriction:0.8,
dynamicFriction:0.6
})
}));
}else{
const z=(Math.random()-0.5)*100;
world.addBody(new Body({
dim:'3D',
shape:new Cube(size,size,size),
pos:new V3(x,y,z),
material:new Material({
color:colors[level%colors.length],
restitution:0.3,
staticFriction:0.8,
dynamicFriction:0.6
})
}));
}
}
}
renderer.addParticles(mode==='2D'?new V2(700,650):new V3(700,650,0),30,'255,215,0');
}

function createWall(){
const colors=['#e74c3c','#e67e22','#f39c12'];
const rows=8;
const cols=10;
const size=30;
const startX=700-cols*size*0.5;
const startY=mode==='2D'?650:650;

for(let row=0;row<rows;row++){
for(let col=0;col<cols;col++){
const offset=row%2===0?0:size*0.5;
const x=startX+col*size+offset;
const y=startY-row*size*1.05;
if(mode==='2D'){
world.addBody(new Body({
dim:'2D',
shape:new Box(size*0.9,size*0.45),
pos:new V2(x,y),
material:new Material({
color:colors[row%colors.length],
restitution:0.2,
staticFriction:0.9,
dynamicFriction:0.7
})
}));
}else{
world.addBody(new Body({
dim:'3D',
shape:new Cube(size*0.9,size*0.45,size*0.7),
pos:new V3(x,y,(Math.random()-0.5)*50),
material:new Material({
color:colors[row%colors.length],
restitution:0.2,
staticFriction:0.9,
dynamicFriction:0.7
})
}));
}
}
}
}

btn2D.addEventListener('click',()=>{
init2D();
btn2D.classList.add('active');
btn3D.classList.remove('active');
});

btn3D.addEventListener('click',()=>{
init3D();
btn3D.classList.add('active');
btn2D.classList.remove('active');
});

btnCircle.addEventListener('click',()=>{
const colors=['#ff6b6b','#4ecdc4','#45b7d1','#f9ca24','#6c5ce7'];
const pos=renderer.camera.pos.clone();
if(mode==='2D'){
pos.y-=300;
world.addBody(new Body({
dim:'2D',
shape:new Circle(15+Math.random()*20),
pos,
material:new Material({
color:colors[Math.floor(Math.random()*colors.length)],
restitution:0.7
})
}));
}else{
pos.y+=300;
world.addBody(new Body({
dim:'3D',
shape:new Sphere(15+Math.random()*20),
pos,
material:new Material({
color:colors[Math.floor(Math.random()*colors.length)],
restitution:0.7
})
}));
}
renderer.addParticles(pos,8);
});

btnBox.addEventListener('click',()=>{
const colors=['#ff6b6b','#4ecdc4','#45b7d1','#f9ca24','#6c5ce7'];
const pos=renderer.camera.pos.clone();
if(mode==='2D'){
pos.y-=300;
world.addBody(new Body({
dim:'2D',
shape:new Box(30+Math.random()*30,30+Math.random()*30),
pos,
angle:Math.random()*Math.PI,
material:new Material({
color:colors[Math.floor(Math.random()*colors.length)],
restitution:0.5
})
}));
}else{
pos.y+=300;
world.addBody(new Body({
dim:'3D',
shape:new Cube(30+Math.random()*25,30+Math.random()*25,30+Math.random()*25),
pos,
material:new Material({
color:colors[Math.floor(Math.random()*colors.length)],
restitution:0.5
})
}));
}
renderer.addParticles(pos,8);
});

btnPyramid.addEventListener('click',createPyramid);
btnWall.addEventListener('click',createWall);

btnReset.addEventListener('click',()=>{
if(mode==='2D')init2D();else init3D();
});

btnPause.addEventListener('click',()=>{
isPaused=!isPaused;
btnPause.textContent=isPaused?'‚ñ∂Ô∏è Resume':'‚è∏Ô∏è Pause';
});

btnDebug.addEventListener('click',()=>{
renderer.debugDraw=!renderer.debugDraw;
btnDebug.classList.toggle('active');
});

function animate(time){
const dt=Math.min((time-lastTime)/1000,0.033);
lastTime=time;

if(!isPaused){
world.step(dt);
input.update(dt);
}

renderer.render(dt);
requestAnimationFrame(animate);
}

init2D();
animate(performance.now());
}
</script>
</body>
</html>
